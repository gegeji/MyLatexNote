\chapter{优化问题初步}
    
\section{优化问题引入}

\begin{problem}
    \label{Problem:ClusteringCenter}
    假设$N$个样本向量$ x_{1}, \ldots, x_{N} \in \mathfrak{R}^{n} $, 需要找到中心向量（centroid）$z$满足

    \begin{equation} \min _{z \in \mathfrak{R}^{n}} \sum_{i=1}^{N}\left\|x_{i}-z\right\|_{2}^{2} \end{equation}
\end{problem}

\begin{definition}[高阶无穷小(记号 $o$)]
    设 $ x, y $ 是同一变化过程中的无穷小， 即 $ x \rightarrow 0, y \rightarrow 0 $, 如果

\begin{equation}
\lim_{x \rightarrow 0, y \rightarrow 0} \frac{y}{x}=0
\end{equation}

则称 $ y $ 是 $ x $ 的高阶无穷小， 记作 $ y=o(x) $.
\end{definition}

\begin{corollary}
    \begin{equation} \lim_{x \rightarrow 0, y \rightarrow 0} \frac{y}{C x}=\frac{1}{C} \lim_{x \rightarrow 0, y \rightarrow 0} \frac{y}{x}=0 \end{equation}

    也即则称 $ y $ 是 $ C x $ 的高阶无穷小， 记作 $ y=o(C x) $ . 
\end{corollary}

\begin{theorem}[凸优化求解的必要条件]
    假设函数$f$在$\hat{x}$可微， 则有

    \begin{equation} \hat{x}=\arg \min _{x \in \mathfrak{R}^{n}} f(x) \Rightarrow \nabla f(\hat{x})=0 \end{equation}
\end{theorem}

\begin{proof}
    假设函数$f$在$\hat{x}$一阶泰勒展开， 有

    \begin{equation} f(x)=f(\hat{x})+\langle\nabla f(\hat{x}), x-\hat{x}\rangle+o\left(\|x-\hat{x}\|_{2}\right) \end{equation}

    假设$ \Delta f(\hat{x}) \neq 0 $, 则令 $ \tilde{x}=\hat{x}-t \nabla f(\hat{x}), t>0 $,可得

    \begin{equation} f(\tilde{x})=f(\hat{x})-t\|\nabla f(\hat{x})\|_{2}^{2}+o\left(t\|\nabla f(\hat{x})\|_{2}\right) \end{equation}

    当 $ t \rightarrow 0 $ 则$ t\|\nabla f(\hat{x})\|_{2} \rightarrow 0 $,  高阶无穷小$ {o }\left(t\|\nabla f(\hat{x})\|_{2}\right) \rightarrow 0 $.

    当$t$足够小时， 存在\begin{equation} t\|\nabla f(\hat{x})\|_{2} \geq o\left(t\|\nabla f(\hat{x})\|_{2}\right) \end{equation}
    
    即\begin{equation} -t\|\nabla f(\hat{x})\|_{2}^{2}+o\left(t\|\nabla f(\hat{x})\|_{2}\right) \leq 0 \end{equation}

    所以
    \begin{equation} f(\tilde{x})=f(\hat{x})-t\|\nabla f(\hat{x})\|_{2}^{2}+o\left(t\|\nabla f(\hat{x})\|_{2}\right) \leq f(\hat{x}) \end{equation}
    
    与 $ \hat{x}=\arg \min _{\mathfrak{R}^{n}} f(x) $ 矛盾。 

    所以$ \nabla f(\widehat{x})=0 $是最优问题解的必要条件。 
\end{proof}

\begin{remark}
    通常 $ \nabla f(\hat{x})=0 \not \Leftrightarrow \hat{x}=\arg \min _{\mathfrak{R}^{n}} f(x) $. 
\end{remark}

\begin{example}
    \begin{equation} f(x)=-x^{2},  x \in \mathfrak{R}, \hat{x}=\arg \min _{\mathfrak{R}} f(x) \end{equation}

    $ \nabla f(\hat{x})=0 $, 则有 $ -2 \hat{x}=0 $, 即 $ \hat{x}=0 $.

    所以
    \begin{equation} f(\hat{x})=0 \geq f(x), \quad x \in \mathfrak{R} \end{equation}


\end{example}

\section{Convex Set}

\begin{definition}[凸集]
    $ \forall x, y \in \Omega, \alpha \in \mathfrak{R}, 0 \leq \alpha \leq 1 $有
    \begin{equation} \alpha x+(1-\alpha) y \in \Omega \end{equation}

    则定义域$ \Omega \in \mathfrak{R}^{n} $称为凸的(Convex)集合。
\end{definition}

几何解释是集合域内两点连线之间都属于这个域。

\begin{definition}[凸函数]
    设函数 $ f(x) $ 定义于称为\term{凸的定义域} $ \Omega \in \mathfrak{R}^{n} $满足
    \begin{equation} f(\alpha x+(1-\alpha) y) \leq \alpha f(x)+(1-\alpha) f(y), \forall x, y \in \Omega, \alpha \in \mathfrak{R}, 0 \leq \alpha \leq 1 \end{equation}

    称其为凸函数。 
\end{definition}

\begin{FigureCenter}{Convex Functions}
    

\tikzset{every picture/.style={line width=0.75pt}} %set default line width to 0.75pt        

\begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
%uncomment if require: \path (0,300); %set diagram left start at 0, and has height of 300

%Straight Lines [id:da5941203123742869] 
\draw  [dash pattern={on 4.5pt off 4.5pt}]  (294.57,180.43) -- (294,219.86) ;
%Straight Lines [id:da3363189709718615] 
\draw [line width=1.5]    (122,221) -- (400,219.88) ;
\draw [shift={(404,219.86)}, rotate = 179.77] [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.08]  [draw opacity=0] (11.61,-5.58) -- (0,0) -- (11.61,5.58) -- cycle    ;
%Straight Lines [id:da40198988041711714] 
\draw [line width=1.5]    (137,242) -- (137.98,13.86) ;
\draw [shift={(138,9.86)}, rotate = 90.25] [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=0.08]  [draw opacity=0] (11.61,-5.58) -- (0,0) -- (11.61,5.58) -- cycle    ;
%Straight Lines [id:da7442547746298689] 
\draw [color={rgb, 255:red, 184; green, 84; blue, 80 }  ,draw opacity=1 ][fill={rgb, 255:red, 184; green, 84; blue, 80 }  ,fill opacity=1 ][line width=1.5]    (173.5,187.5) -- (380,76.86) ;
%Shape: Free Drawing [id:dp3431849186843734] 
\draw  [color={rgb, 255:red, 0; green, 0; blue, 0 }  ][line width=2.25] [line join = round][line cap = round] (171,119.86) .. controls (173.32,119.86) and (177.26,137.88) .. (179,140.86) .. controls (185.56,152.1) and (197.17,170.1) .. (209,176.86) .. controls (221.57,184.04) and (236.63,186.14) .. (251,187.86) .. controls (299.94,193.74) and (340.82,147.7) .. (354,104.86) .. controls (357.02,95.06) and (364,84.76) .. (364,74.86) ;
%Shape: Circle [id:dp30513847533846006] 
\draw  [color={rgb, 255:red, 245; green, 166; blue, 35 }  ,draw opacity=1 ][fill={rgb, 255:red, 245; green, 166; blue, 35 }  ,fill opacity=1 ] (289.14,124.43) .. controls (289.14,121.98) and (291.12,120) .. (293.57,120) .. controls (296.02,120) and (298,121.98) .. (298,124.43) .. controls (298,126.88) and (296.02,128.86) .. (293.57,128.86) .. controls (291.12,128.86) and (289.14,126.88) .. (289.14,124.43) -- cycle ;
%Shape: Circle [id:dp29963982252040666] 
\draw  [color={rgb, 255:red, 245; green, 166; blue, 35 }  ,draw opacity=1 ][fill={rgb, 255:red, 245; green, 166; blue, 35 }  ,fill opacity=1 ] (290.14,180.43) .. controls (290.14,177.98) and (292.12,176) .. (294.57,176) .. controls (297.02,176) and (299,177.98) .. (299,180.43) .. controls (299,182.88) and (297.02,184.86) .. (294.57,184.86) .. controls (292.12,184.86) and (290.14,182.88) .. (290.14,180.43) -- cycle ;
%Straight Lines [id:da0584717345411474] 
\draw  [dash pattern={on 4.5pt off 4.5pt}]  (202.57,172.43) -- (203,220.86) ;
%Straight Lines [id:da5902664164674105] 
\draw  [dash pattern={on 4.5pt off 4.5pt}]  (360.57,88.43) -- (359,219.86) ;
%Straight Lines [id:da14324118358657834] 
\draw [color={rgb, 255:red, 245; green, 166; blue, 35 }  ,draw opacity=1 ][fill={rgb, 255:red, 184; green, 84; blue, 80 }  ,fill opacity=1 ][line width=1.5]    (294,252.86) -- (294.85,229.86) ;
\draw [shift={(295,225.86)}, rotate = 92.12] [fill={rgb, 255:red, 245; green, 166; blue, 35 }  ,fill opacity=1 ][line width=0.08]  [draw opacity=0] (11.61,-5.58) -- (0,0) -- (11.61,5.58) -- cycle    ;

% Text Node
\draw (197,224.4) node [anchor=north west][inner sep=0.75pt]  [xscale=0.75,yscale=0.75]  {$x$};
% Text Node
\draw  [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=0 ][fill={rgb, 255:red, 245; green, 166; blue, 35 }  ,fill opacity=1 ]  (215,260) .. controls (215,257.24) and (217.24,255) .. (220,255) -- (359,255) .. controls (361.76,255) and (364,257.24) .. (364,260) -- (364,274) .. controls (364,276.76) and (361.76,279) .. (359,279) -- (220,279) .. controls (217.24,279) and (215,276.76) .. (215,274) -- cycle  ;
\draw (218,259.4) node [anchor=north west][inner sep=0.75pt]  [xscale=0.75,yscale=0.75]  {$u=\alpha x+( 1-\alpha ) y)$};
% Text Node
\draw (353,225.4) node [anchor=north west][inner sep=0.75pt]  [xscale=0.75,yscale=0.75]  {$y$};
% Text Node
\draw  [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=0 ][fill={rgb, 255:red, 240; green, 139; blue, 134 }  ,fill opacity=1 ]  (175,42) .. controls (175,39.24) and (177.24,37) .. (180,37) -- (377,37) .. controls (379.76,37) and (382,39.24) .. (382,42) -- (382,56) .. controls (382,58.76) and (379.76,61) .. (377,61) -- (180,61) .. controls (177.24,61) and (175,58.76) .. (175,56) -- cycle  ;
\draw (178,41.4) node [anchor=north west][inner sep=0.75pt]  [xscale=0.75,yscale=0.75]  {$\alpha f( x) +( 1-\alpha ) f( y) \geq f( u)$};


\end{tikzpicture}
\end{FigureCenter}

\subsection{Examples for Convex Functions}

\begin{example}
    \label{Example:SquareIsConvex}
    \begin{equation} f(x)=x^{2}, x \in \mathfrak{R} \end{equation}

    \begin{equation}\begin{aligned}
        f(\alpha x+(1-\alpha )y) & =(\alpha x+(1-\alpha )y)^{2}\\
         & =\textcolor[rgb]{0.96,0.65,0.14}{\alpha ^{2} x^{2}} +2\alpha (1-\alpha )xy+\textcolor[rgb]{0.25,0.46,0.02}{(1-\alpha )^{2} y^{2}}\\
         & =\textcolor[rgb]{0.96,0.65,0.14}{\alpha x^{2}} +\textcolor[rgb]{0.25,0.46,0.02}{(1-\alpha )y^{2}} +\textcolor[rgb]{0.96,0.65,0.14}{\left( \alpha ^{2} -\alpha \right) x^{2}} +\textcolor[rgb]{0.25,0.46,0.02}{\left( \alpha ^{2} -\alpha \right) y^{2}} +2\alpha (1-\alpha )xy\\
         & =\alpha x^{2} +(1-\alpha )y^{2} -\alpha (1-\alpha )(x-y)^{2}\\
         & \leq \alpha x^{2} +(1-\alpha )y^{2} =\alpha f(x)+(1-\alpha )f(y)
        \end{aligned}\end{equation}
\end{example}

\begin{example}
    \label{Example:NormIsConvex}
    $ f(x)=\|x\| $, 其中 $ \|  \cdot \| $ 表示 $ \mathfrak{R}^{n} $ 上的向量范数， $ x \in \mathfrak{R}^{n} $.
\end{example}

\begin{proof}
    \label{Example:L2NormIsConvex}
    \begin{equation} \|\alpha x+(1-\alpha) y\| \leq\|\alpha x\|+\|(1-\alpha) y\|=|\alpha|\|x\|+|1-\alpha|\|y\| \end{equation}
\end{proof}

\begin{example}
    \begin{equation} f(x)=\|x\|_{2}^{2}, x \in \mathfrak{R}^{n} \end{equation}
\end{example}

\subsection{凸函数的充要条件}

\begin{theorem}[可微函数$f$是凸函数的充要条件]
    \label{Theorem:ConvexDiffential}

    可微函数$f$是凸函数等价于
    \begin{equation} f(y) \geq f(x)+\langle\nabla f(x), y-x\rangle, \quad \forall x, y \end{equation}
\end{theorem}

\begin{proof}
    1. 首先， 证明一维情况 $ f: \mathfrak{R} \rightarrow \mathfrak{R}, \alpha \in[0,1] $.

    $ \Rightarrow  $ 充分条件: 
    
    由可微函数$f$是凸函数可知
    \begin{equation} f(\alpha x+(1-\alpha) y)=f(x+(1-\alpha)(y-x)) \leq \alpha f(x)+(1-\alpha) f(y) \end{equation}
    
    因此有
    \begin{equation} f(y) \geq f(x)+\frac{f(x+(1-\alpha)(y-x))-f(x)}{(1-\alpha)(y-x)}(y-x) \end{equation}

    令 $ \alpha \rightarrow 1^- $, 则有 $ f(y) \geq f(x)+f^{\prime}(x)(y-x) $.

    $ \Leftarrow  $ 必要条件：
    
    令 $ y \neq x, z=\alpha x+(1-\alpha) y$则有

    \begin{equation}  f(x) \geq f(z)+f^{\prime}(z)(x-z), f(y) \geq f(z)+f^{\prime}(z)(y-z)  \end{equation}

    可得 
    \begin{equation}\begin{aligned}
        \alpha f(x)+(1-\alpha) f(y) &\geq f(z)+\alpha f^{\prime}(z)(x-z)+(1-\alpha) f^{\prime}(z)(y-z) \\
        &=f(z)+f^{\prime}(z)(\alpha x+(1-\alpha) y-z) \\
        &=f(z)
    \end{aligned}
    \end{equation}

    满足凸函数定义，所以$f$是凸函数。

    2. 证明 $ n $ 维情况 $ f: \mathfrak{R}^{n} \rightarrow \mathfrak{R} $.

    $ \Rightarrow $ 充分条件：
    
    令 \begin{equation} g(t)=f(t x+(1-t) y), t \in \mathfrak{R} \end{equation}

    则\begin{equation} g^{\prime}(t)=\langle\nabla f(t x+(1-t) y), x-y\rangle \end{equation}

    由于 $ f $ 是凸函数， 证明 $ g(t) $ 也是凸函数；并可得 $ g(0) \geq g(1)+g^{\prime}(1)(-1) $, 得证。

    $ \Leftarrow $ 必要条件：
    与一维类似。 (将$f^{\prime}$改为$\nabla f(z)^T$) 
\end{proof}

\begin{theorem}
    如果可微函数$f$是凸函数， 则有

    \begin{equation} \hat{x}=\arg \min _{x \in \mathfrak{R}^{n}} f(x) \Leftrightarrow \nabla f(\hat{x})=0 \end{equation}
\end{theorem}

\begin{proof}
    已证 $ \hat{x}=\arg \min _{x \in \mathfrak{R}^{n}} f(x) \Rightarrow $ 可得 $ \nabla f(\hat{x})=0 $

    只需证 $ \nabla f(\hat{x})=0 \Rightarrow \hat{x}=\arg \min _{x \in \mathfrak{R}^{n}} f(x) $.

    由于函数 $ f $ 是可微凸的， 则有 $ \forall x \in \mathfrak{R}^{n} $,
\begin{equation}
\begin{aligned}
f(x) & \geq f(\hat{x})+\langle\nabla f(\hat{x}), x-\hat{x}\rangle \\
& = f(\hat{x})+\langle 0, x-\hat{x}\rangle 
\\ & \geq f(\hat{x})
\end{aligned}
\end{equation}

可得 $ f(x) \geq f(\hat{x}), \hat{x}=\arg \min _{x \in \mathfrak{R}^{n}} f(x) $.
\end{proof}

\section{向量偏导}

\begin{definition}[向量对向量的导数]
    \label{Definition:VectorVectorDerivative}
    \begin{equation} x=\left[\begin{array}{c}x_{1} \\ \vdots \\ x_{n}\end{array}\right], z=\left[\begin{array}{c}z_{1} \\ \vdots \\ z_{n}\end{array}\right] \end{equation}

    \begin{equation} \nabla f(z)=\left[\begin{array}{c}\frac{\partial f(z)}{\partial z_{1}} \\ \vdots \\ \frac{\partial f(z)}{\partial z_{n}}\end{array}\right] \end{equation}
\end{definition}

\begin{example}
    \begin{equation} f(z)=x^{T} z+z^{T} z=\sum_{i=1}^{n}\left\{x_{i} z_{i}+z_{i}^{2}\right\} \end{equation}

    它的导数是
    \begin{equation} \nabla f(z)=\left[\begin{array}{c}\frac{\partial f(z)}{\partial z_{1}} \\ \vdots \\ \frac{\partial f(z)}{\partial z_{n}}\end{array}\right]=\left[\begin{array}{c}x_{1}+2 z_{1} \\ \vdots \\ x_{n}+2 z_{n}\end{array}\right]=x+2 z \end{equation}
\end{example}


问题\ref{Problem:ClusteringCenter}中已知目标函数是凸函数。 （见\ref{Example:SquareIsConvex}, \ref{Example:NormIsConvex}, \ref{Example:L2NormIsConvex}），则可以求解问题\ref{Problem:ClusteringCenter}的最优解。

\begin{proof}
    

\begin{equation} f(z)=\sum_{i=1}^{N}\left\|x_{i}-z\right\|_{2}^{2}=\sum_{i=1}^{N}\left\langle x_{i}-z, x_{i}-z\right\rangle=\sum_{i=1}^{N}\left\{x_{i}^{T} x_{i}-2 x_{i}^{T} z+z_{i}^{T} z\right\} \end{equation}

利用等价条件\ref{Theorem:ConvexDiffential}

\begin{equation} \nabla f(z)=\sum_{i=1}^{N}\left\{-2 x_{i}+2 z\right\}=0 \end{equation} (求导 \ref{Definition:VectorVectorDerivative})

\begin{equation} z=\frac{1}{N} \sum_{i=1}^{N} x_{i} \end{equation}
\end{proof}

另解：

\begin{proof}
    $ J\left(x_{0}\right)=\sum_{i=1}^{n}\left\|x_{0}-x_{i}\right\|^{2} ， $ 其中 $ m=\frac{1}{n} \sum_{i=1}^{n} x_{i} $

    \begin{equation}\begin{aligned}
        J\left(x_{0}\right)&=\sum_{i=1}^{n}\left\|\left(x_{0}-m\right)-\left(x_{i}-m\right)\right\|^{2} \\
        &=\sum_{i=1}^{n}\left\|x_{0}-m\right\|^{2}-2 \sum_{i=1}^{n}\left(x_{0}-m\right)^{T}\left(x_{i}-m\right)+\sum_{i=1}^{n}\left\|x_{i}-m\right\|^{2} \\
        &= \sum_{i=1}^{n}\left\|x_{0}-m\right\|^{2}-2\left(x_{0}-m\right)^{T} \sum_{i=1}^{n}\left(x_{i}-m\right)+\sum_{i=1}^{n}\left\|x_{i}-m\right\|^{2}
    \end{aligned}\end{equation}


因为
\begin{equation} \sum_{i=1}^{n}\left(x_{i}-m\right)=\sum_{i=1}^{n} x_{i}-n m=\sum_{i=1}^{n} x_{i}-n \cdot \frac{1}{n} \sum_{i=1}^{n} x_{i}=0 \end{equation}

所以有 \begin{equation} J\left(x_{0}\right)=\sum_{i=1}^{n}\left\|x_{0}-m\right\|^{2}+\sum_{i=1}^{n}\left\|x_{i}-m\right\|^{2} \end{equation}

即当$x_0$等于均值时，目标函数有最小均方。
\end{proof}

\section{标量优化问题：投影问题}

\begin{FigureCenter}{Projection onto a Line}
   

\tikzset{every picture/.style={line width=0.75pt}} %set default line width to 0.75pt        

\begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
%uncomment if require: \path (0,300); %set diagram left start at 0, and has height of 300

%Straight Lines [id:da8764321810021003] 
\draw [color={rgb, 255:red, 215; green, 155; blue, 0 }  ,draw opacity=1 ][line width=1.5]    (152,230) -- (286,230.46) ;
\draw [shift={(290,230.47)}, rotate = 180.2] [fill={rgb, 255:red, 215; green, 155; blue, 0 }  ,fill opacity=1 ][line width=0.08]  [draw opacity=0] (11.61,-5.58) -- (0,0) -- (11.61,5.58) -- cycle    ;
%Straight Lines [id:da47866964225433306] 
\draw [color={rgb, 255:red, 184; green, 84; blue, 80 }  ,draw opacity=1 ][line width=3]    (152,230) -- (206,230.26) ;
\draw [shift={(212,230.29)}, rotate = 180.28] [fill={rgb, 255:red, 184; green, 84; blue, 80 }  ,fill opacity=1 ][line width=0.08]  [draw opacity=0] (16.97,-8.15) -- (0,0) -- (16.97,8.15) -- cycle    ;
%Straight Lines [id:da7728847142920288] 
\draw [color={rgb, 255:red, 130; green, 179; blue, 102 }  ,draw opacity=1 ][line width=2.25]    (152,230) -- (207.49,117.78) ;
\draw [shift={(209.71,113.29)}, rotate = 476.31] [fill={rgb, 255:red, 130; green, 179; blue, 102 }  ,fill opacity=1 ][line width=0.08]  [draw opacity=0] (14.29,-6.86) -- (0,0) -- (14.29,6.86) -- cycle    ;
%Straight Lines [id:da29849014601149504] 
\draw  [dash pattern={on 0.84pt off 2.51pt}]  (209.71,113.29) -- (212,230.29) ;

% Text Node
\draw (210,90.4) node [anchor=north west][inner sep=0.75pt]    {$b$};
% Text Node
\draw (193,237.4) node [anchor=north west][inner sep=0.75pt]    {$\hat{t} a$};
% Text Node
\draw (298,222.4) node [anchor=north west][inner sep=0.75pt]    {$a$};
% Text Node
\draw (221,167.4) node [anchor=north west][inner sep=0.75pt]    {$b-\hat{t} a$};


\end{tikzpicture}

\end{FigureCenter}


\begin{problem}
    假设$ a, b \in \mathfrak{R}^{n}, a \neq 0, t \in \mathfrak{R}$, 当$t$ 多大时， $ta$到$b$之间的距离最小

    \begin{equation} \hat{t}=\min _{t}\|t a-b\|_{2}^{2} \end{equation}
\end{problem}

    \begin{remark}
        $t$是标量，$ta$是向量。
    \end{remark}

    定义
    \begin{equation} f(t)=\|t a-b\|_{2}^{2}=\langle t a-b, t a-b\rangle=t^{2} a^{T} a-2 t a^{T} b+b^{T} b \end{equation}

    It is a quadratic function of $ t $ with positive leading coefficient $ a^{T} a $. 可以验证$f(t)$满足凸函数的定义。

    \begin{equation} \nabla f(t)=2 t a^{T} a-2 a^{T} b=0 \end{equation}

    \begin{equation} \hat{t}=\frac{a^{T} b}{a^{T} a}=\frac{a^{T} b}{\|a\|_{2}^{2}} \end{equation}





\begin{FigureCenter}{Projection onto a Line from the Prospective of Linear Algebra}
    \tikzset{every picture/.style={line width=0.75pt}} %set default line width to 0.75pt        

\begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
%uncomment if require: \path (0,371); %set diagram left start at 0, and has height of 371

%Straight Lines [id:da055809839407445105] 
\draw    (12.54,89.33) -- (14.23,285.69) ;
%Straight Lines [id:da12985171386013317] 
\draw    (14.23,285.69) -- (154.84,285.69) ;
%Straight Lines [id:da5377763269926785] 
\draw [color={rgb, 255:red, 215; green, 155; blue, 0 }  ,draw opacity=1 ][line width=2.25]    (14.23,285.69) -- (58.81,97.49) ;
\draw [shift={(59.97,92.63)}, rotate = 463.33] [fill={rgb, 255:red, 215; green, 155; blue, 0 }  ,fill opacity=1 ][line width=0.08]  [draw opacity=0] (16.07,-7.72) -- (0,0) -- (16.07,7.72) -- (10.67,0) -- cycle    ;
%Straight Lines [id:da49492424918304767] 
\draw [color={rgb, 255:red, 130; green, 179; blue, 102 }  ,draw opacity=1 ][line width=2.25]    (14.23,285.69) -- (158.55,239.37) ;
\draw [shift={(163.31,237.84)}, rotate = 522.2] [fill={rgb, 255:red, 130; green, 179; blue, 102 }  ,fill opacity=1 ][line width=0.08]  [draw opacity=0] (16.07,-7.72) -- (0,0) -- (16.07,7.72) -- (10.67,0) -- cycle    ;
%Straight Lines [id:da8103869094631817] 
\draw [color={rgb, 255:red, 184; green, 84; blue, 80 }  ,draw opacity=1 ][line width=2.25]    (14.23,285.69) -- (104.33,257.48) ;
\draw [shift={(109.1,255.99)}, rotate = 522.62] [fill={rgb, 255:red, 184; green, 84; blue, 80 }  ,fill opacity=1 ][line width=0.08]  [draw opacity=0] (16.07,-7.72) -- (0,0) -- (16.07,7.72) -- (10.67,0) -- cycle    ;
%Straight Lines [id:da03005700586607185] 
\draw [line width=1.5]  [dash pattern={on 5.63pt off 4.5pt}]  (59.97,92.63) -- (109.1,255.99) ;
%Shape: Rectangle [id:dp5894620344568704] 
\draw   (0.64,3.19) -- (495.64,3.19) -- (495.64,370.19) -- (0.64,370.19) -- cycle ;

% Text Node
\draw (61.02,72.24) node [anchor=north west][inner sep=0.75pt]    {$\boldsymbol{b}$};
% Text Node
\draw (110.52,260.07) node [anchor=north west][inner sep=0.75pt]    {$\boldsymbol{p=}\hat{x}\boldsymbol{a}$};
% Text Node
\draw (168.58,227.91) node [anchor=north west][inner sep=0.75pt]    {$\boldsymbol{a}$};
% Text Node
\draw (110.81,158.31) node [anchor=north west][inner sep=0.75pt]   [align=left] {error $\displaystyle \boldsymbol{e} =\boldsymbol{b-p}$};
% Text Node
\draw  [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=0 ][fill={rgb, 255:red, 157; green, 217; blue, 123 }  ,fill opacity=1 ]  (301,48) .. controls (301,45.24) and (303.24,43) .. (306,43) -- (403,43) .. controls (405.76,43) and (408,45.24) .. (408,48) -- (408,65) .. controls (408,67.76) and (405.76,70) .. (403,70) -- (306,70) .. controls (303.24,70) and (301,67.76) .. (301,65) -- cycle  ;
\draw (304,47.4) node [anchor=north west][inner sep=0.75pt]    {$\boldsymbol{a^{T}( b} -\hat{x}\boldsymbol{a}) =0$};
% Text Node
\draw (304,77.4) node [anchor=north west][inner sep=0.75pt]    {$\boldsymbol{a^{T} b} -\hat{x}\boldsymbol{a^{T} a} =0$};
% Text Node
\draw  [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=0 ][fill={rgb, 255:red, 157; green, 217; blue, 123 }  ,fill opacity=1 ]  (301,116) .. controls (301,113.24) and (303.24,111) .. (306,111) -- (362,111) .. controls (364.76,111) and (367,113.24) .. (367,116) -- (367,159) .. controls (367,161.76) and (364.76,164) .. (362,164) -- (306,164) .. controls (303.24,164) and (301,161.76) .. (301,159) -- cycle  ;
\draw (304,115.4) node [anchor=north west][inner sep=0.75pt]    {$\hat{x} =\boldsymbol{\frac{a^{T} b}{a^{T} a}}$};
% Text Node
\draw  [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=0 ][fill={rgb, 255:red, 157; green, 217; blue, 123 }  ,fill opacity=1 ]  (302,184) .. controls (302,181.24) and (304.24,179) .. (307,179) -- (465,179) .. controls (467.76,179) and (470,181.24) .. (470,184) -- (470,227) .. controls (470,229.76) and (467.76,232) .. (465,232) -- (307,232) .. controls (304.24,232) and (302,229.76) .. (302,227) -- cycle  ;
\draw (305,183.4) node [anchor=north west][inner sep=0.75pt]    {$\boldsymbol{p} =\hat{x}\boldsymbol{a=\frac{a^{T} b}{a^{T} a} a=a\frac{a^{T} b}{a^{T} a}}$};
% Text Node
\draw (86.05,128.12) node [anchor=north west][inner sep=0.75pt]    {$\boldsymbol{b}$};
% Text Node
\draw  [color={rgb, 255:red, 0; green, 0; blue, 0 }  ,draw opacity=0 ][fill={rgb, 255:red, 157; green, 217; blue, 123 }  ,fill opacity=1 ]  (303,259) .. controls (303,256.24) and (305.24,254) .. (308,254) -- (365,254) .. controls (367.76,254) and (370,256.24) .. (370,259) -- (370,302) .. controls (370,304.76) and (367.76,307) .. (365,307) -- (308,307) .. controls (305.24,307) and (303,304.76) .. (303,302) -- cycle  ;
\draw (306,258.4) node [anchor=north west][inner sep=0.75pt]    {$\boldsymbol{P=\frac{\boldsymbol{a} a^{T}}{a^{T} a}}$};

\end{tikzpicture}
\end{FigureCenter}



\section{$k$-Means Clustering}

将物理或抽象对象的集合分成由类似特征组成的多个类的过程称为\term{聚类(clustering)}.



目标：分成$k$个集合， 尽量使得同一个集合中的向量彼此接近。 

\begin{notation}
    给定$N$个$n$维向量 $ x_{1}, \ldots, x_{N} \in \mathfrak{R}^{n} $

    \begin{itemize}
        \item 标签 $ c_{i} \in\{1,2, \cdots, k\} $ 表示向量 $ x_{i} $ 所属类别， 例如 $ c_{i}=2 $ 表示 $ x_{i} $ 属于第2类。 
        \item 对于 $ j=1, \ldots, k, \quad G_{j}=\left\{i: c_{i}=j\right\} $ 表示属于第$j$类的向量 $ x_{i} $ 的下标集合。 
        \item 向量 $ z_{j}, j=1, \ldots, k $, 表示同属于 $ j $ 类的向量 $ x_{i}, i \in G_{j} $ 的聚类中心。 
    \end{itemize}
\end{notation}

聚类目标是找到向量 $ x_{i} $ 的“标签 $ c_{i} $”和“聚类中心 $ z_{j} $”。

\begin{problem}
    \begin{equation} \min _{z_{j}} \sum_{i \in G_{j}}\left\|x_{i}-z_{j}\right\|_{2}^{2}, j=1, \cdots, k \end{equation}

    \begin{equation} c_{i}=
    \arg \min_{j=\{1, \cdots, k\}} \left\|x_{i}-z_{j}\right\|_{2}^{2}, i=1,2, \ldots, N \end{equation}

    \begin{equation} \begin{aligned} f_{j}\left(z_{j}\right)=& \sum_{i \in G_{j}}\left\|x_{i}-z_{j}\right\|_{2}^{2}, J\left(G_{1}, \cdots, G_{k}, z_{1}, \cdots, z_{k}\right)=\sum_{j=1}^{k} f_{j}\left(z_{j}\right) \\ & \min _{G_{1}, \cdots, G_{k}} \min _{z_{1}, \cdots, z_{k}} J\left(G_{1}, \cdots, G_{k}, z_{1}, \cdots, z_{k}\right) \end{aligned} \end{equation}
\end{problem}

$k$-means算法是将 $ {N} $ 向量 $ x_{i} \in \mathfrak{R}^{n} $ 划分成$k$类的迭代聚类算法。 

\begin{algorithm}
    \caption{$k$-means Algorithm}
    在 $ {N} $ 个点中随机选取$k$个点， 分别作为聚类中心 $ z_{j} $\;
    更新聚类标签 $ c_{i} $ : 计算每个点 $ x_{i} $ 到$k$个聚类中心 $ z_{j} $ 的距离， 并将其分配到最近的聚类中心 $ z_{j} $ 所在的聚类中 $ c_{i}=j $\;
    更新聚类中心 $ z_{j} $ ：重新计算每个聚类现在的质心， 并以其作作为新的聚类中心， 根据更新标签 $ c_{i} $, 更新属于第$j$类下标集合$ G_{j}=\left\{i: c_{i}=j\right\} $, 重新计算 $ c_{i} $ 类的聚类中心 $ z_{j} $\;
    重复步骤2、3, 直到所有聚类中心不再变化
\end{algorithm}

\begin{proof}
    更新聚类标签 $ c_{i} $:

    \begin{equation} \left\|x_{i}-z_{j}\right\|_{2}^{2}=\arg \min \left\{\left\|x_{i}-z_{1}\right\|_{2}^{2},\left\|x_{i}-z_{2}\right\|_{2}^{2}, \cdots,\left\|x_{i}-z_{k}\right\|_{2}^{2}\right\} \end{equation}

    更新聚类中心 $ z_{j} $：

    \begin{equation} \nabla f_{j}\left(z_{j}\right)=\sum_{i \in G_{j}} 2\left(x_{i}-z_{j}\right)=0 \end{equation}
\begin{equation} z_{j}=\frac{1}{\left|G_{j}\right|} \sum_{i \in G_{j}} x_{i} \end{equation}

$ \left|G_{j}\right| $ 表示集合 $ G_{j} $ 中元素的数目。 
\end{proof}

在每一次迭代中目标函数$J$都会下降， 直到聚类中心 $ z_{1}, \cdots, z_{k} $ 和 划分聚类标签集合 $ G_{1}, \cdots, G_{k} $ 不再变化。 

但是$k$-means算法依赖于初始随机生成的聚类中心， 只可得到目标函数$J$的局部局部最优。 

解决方案：使用不同的(随机的)初始聚类中心运行$k$-means算法若干次， 取目标函数$J$值最小的一次作为最终的聚类结果。 

