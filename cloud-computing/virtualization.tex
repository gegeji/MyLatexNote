\chapter{äº‘è®¡ç®—å…³é”®æŠ€æœ¯}

\section{è™šæ‹ŸåŒ–}

\begin{definition}[è™šæ‹ŸåŒ–]
    é€šè¿‡è¯¥æŠ€æœ¯å°†ä¸€å°è®¡ç®—æœºè™šæ‹Ÿä¸ºå¤šå°é€»è¾‘è®¡ç®—æœºã€‚ åœ¨ä¸€å°è®¡ç®—æœºä¸ŠåŒæ—¶è¿è¡Œå¤šä¸ªé€»è¾‘è®¡ç®—æœºï¼Œæ¯ä¸ªé€»è¾‘è®¡ç®—æœºå¯è¿è¡Œä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºéƒ½å¯ä»¥åœ¨ç›¸äº’ç‹¬ç«‹çš„ç©ºé—´å†…è¿è¡Œè€Œäº’ä¸å½±å“ï¼Œä»è€Œæ˜¾è‘—æé«˜è®¡ç®—æœºçš„å·¥ä½œæ•ˆç‡ã€‚ 
\end{definition}

\begin{example}[Amazonå¼€å¯è™šæ‹Ÿæœº]
    é€‰æ‹©amiï¼ˆguest OS imageï¼‰ï¼šæ”¯æŒçš„virtualization type (\term{paravirtual} åŠè™šæ‹ŸåŒ– $\rightarrow$ æ€§èƒ½ä¸ä¸€è‡´)
\end{example}

\begin{figure}
    \centering
    \begin{subfigure}[b]{0.3 \textwidth}
        \centering
        \includegraphics[width=\textwidth]{cloud-pc-architecture.png}
    \end{subfigure}
    \begin{subfigure}[b]{0.3 \textwidth}
        \centering
        \includegraphics[width=\textwidth]{cloud-vmware-architecture.png}
    \end{subfigure}
\end{figure}

\begin{definition}[Host Machine]
    ç‰©ç†æœº
\end{definition}

\begin{definition}[Host OS]
    è¿è¡Œåœ¨ç‰©ç†æœºä¹‹ä¸Šçš„OS
\end{definition}

\begin{definition}[Hypervisor, Virtual Machine Monitor (VMM)]
    è™šæ‹Ÿæœºç›‘æ§å™¨
\end{definition}

\begin{definition}[Virtual Machine]
    è™šæ‹Ÿå‡ºæ¥çš„è™šæ‹Ÿæœº
\end{definition}

\begin{definition}[Guest OS]
    è¿è¡Œåœ¨è™šæ‹Ÿæœºä¹‹ä¸Šçš„OS
\end{definition}

å‡å¦‚ä¸€ä¸ªæ ¸åˆ†ç»™2ä¸ªè™šæ‹Ÿæœºï¼Œåˆ™å¹³å°ï¼ŒOSéœ€è¦åˆ†æ—¶åˆ‡æ¢ã€‚ï¸ ç½‘ç»œçš„è™šæ‹ŸåŒ–éš”ç¦»éš¾ä»¥å®ç°ï¼Œå› æ­¤è™šæ‹ŸåŒ–æœºç½‘ç»œæ€§èƒ½ä¸ç¨³å®š, è™šæ‹Ÿæœºçš„ç½‘ç»œè½¬å‘åˆ°ç‰©ç†æœºçš„ç½‘ç»œä¸­ã€‚

è™šæ‹ŸåŒ–ç‰¹ç‚¹:

\begin{itemize}
    \item åˆ†åŒº: åœ¨å•ä¸€ç‰©ç†æœåŠ¡å™¨ä¸ŠåŒæ—¶è¿è¡Œå¤šä¸ªè™šæ‹Ÿæœº
    \item éš”ç¦»: åœ¨åŒä¸€æœåŠ¡å™¨ä¸Šçš„è™šæ‹Ÿæœºç›¸äº’éš”ç¦»
    \item å°è£…: æ•´ä¸ªè™šæ‹Ÿæœºéƒ½ä¿å­˜åœ¨æ–‡ä»¶ä¸­ï¼Œè€Œä¸”å¯ä»¥é€šè¿‡ç§»åŠ¨å’Œå¤åˆ¶è¿™äº›æ–‡ä»¶çš„æ–¹å¼æ¥ç§»åŠ¨å’Œå¤åˆ¶è¯¥è™šæ‹Ÿæœº
\end{itemize}

è™šæ‹Ÿæœºä¸Šè¯»å–æ•°æ®ï¼Ÿ 

ç¡¬ä»¶ç£ç›˜æŒ‚è½½åœ¨ç¡¬ä»¶ä¸Š guest OSè½¬æ¢è¯·æ±‚åˆ°hypervisor$\rightarrow$ OS$\rightarrow$ ç¡¬ä»¶ä»¥éš”ç¦»ä¸åŒè™šæ‹Ÿæœºï¼Œoverheadå¤§

\subsection{ä»è™šæ‹Ÿå¹³å°è§’åº¦åˆ’åˆ†çš„åˆ†ç±»}

\subsubsection{å…¨è™šæ‹ŸåŒ–}

\begin{definition}[å…¨è™šæ‹ŸåŒ–]
    è™šæ‹Ÿçš„æ“ä½œç³»ç»Ÿ,ä¸åº•å±‚çš„ç¡¬ä»¶å®Œå…¨éš”ç¦»,ç”±ä¸­é—´çš„Hypervisorå±‚è½¬åŒ–ã€‚ 
    
    å…¸å‹çš„ä»£è¡¨æœ‰Vmware WorkStation, Microsoft Virtrual Server. 
\end{definition}

\begin{definition}[KVM]
    KVM (for Kernel-based Virtual Machine) is a full virtualization solution for Linux on x86 hardware containing virtualization extensions (Intel VT or AMD-V). It consists of a loadable kernel module, kvm.ko, that provides the core virtualization infrastructure and a processor specific module, kvm-intel.ko or kvm-amd.ko
\end{definition}

å®Œå…¨éš”ç¦»ï¼Œç”±hypervisorå±‚è½¬æ¢ 

VMware workstationï¼šé€Ÿåº¦å‡æ…¢ï¼Œæ€§èƒ½ç“¶é¢ˆï¼Œéš”ç¦»æ›´å¥½

\subsubsection{åŠè™šæ‹ŸåŒ–}

\begin{definition}[åŠè™šæ‹ŸåŒ–]
    è™šæ‹Ÿæœºçš„æ“ä½œç³»ç»Ÿå½“ä¸­åŠ å…¥ç‰¹å®šçš„è™šæ‹ŸåŒ–æŒ‡ä»¤,å¯ä»¥\textbf{ç›´æ¥é€šè¿‡Hypervisorè°ƒç”¨ç¡¬ä»¶èµ„æº},å…é™¤äº†Hypervisorå±‚è½¬æ¢æŒ‡ä»¤çš„å¼€é”€ã€‚ 
    
    å…¸å‹ä»£è¡¨æœ‰Xen, Hyper-V
\end{definition}

ä½¿å¾—OSå’Œè™šæ‹ŸåŒ–å±‚ååŒå·¥ä½œï¼Œå‡è½»2å±‚OSçš„è´Ÿæ‹…ï¼Œä½†æ˜¯éœ€å¯¹OSè¿›è¡Œæ”¹åŠ¨ï¼ŒOSçŸ¥é“æ­£å¤„äºè™šæ‹ŸåŒ–ç¯å¢ƒä¸­ï¼Œå¼€é”€å‡å°

xenï¼ˆä¹Ÿé€æ¸æ”¯æŒå…¨è™šæ‹ŸåŒ–ï¼Œä»¥æå‡é€šç”¨æ€§ï¼‰

\begin{definition}[Xen]
    The Xen Project community develops an open-source type-1 or bare-metal hypervisor, which makes it possible to run many instances of an operating system or indeed different operating systems in parallel on a single machine (or host). The project develops the only type-1 hypervisor that is available as open source. The hypervisor is used as the basis for a number of different commercial and open source applications, such as server virtualization, Infrastructure as a Service (IaaS), desktop virtualization, security applications, embedded and hardware appliances, and automotive. It enables users to increase server utilization, consolidate server farms, reduce complexity, and decrease total cost of ownership.
\end{definition}

\subsection{ä»è™šæ‹ŸåŒ–çš„å±‚æ¬¡åˆ’åˆ†}

\subsubsection{è½¯ä»¶è¾…åŠ©çš„è™šæ‹ŸåŒ–æŠ€æœ¯}

\begin{definition}[è½¯ä»¶è¾…åŠ©çš„è™šæ‹ŸåŒ–æŠ€æœ¯]
    é€šè¿‡è½¯ä»¶çš„æ–¹æ³•,è®©å®¢æˆ·æœºçš„ç‰¹æƒæŒ‡ä»¤é™·å…¥å¼‚å¸¸,ä»è€Œè§¦å‘å®¿ä¸»æœºè¿›è¡Œè™šæ‹ŸåŒ–ã€‚ å¦‚Hyper-Vç­‰ã€‚ 
\end{definition}

\begin{definition}[Hyper-V]
    Hyper-V specifically provides hardware virtualization. That means each virtual machine runs on virtual hardware. Hyper-V lets you create virtual hard drives, virtual switches, and a number of other virtual devices all of which can be added to virtual machines
\end{definition}

\subsubsection{ç¡¬ä»¶æ”¯æŒçš„è™šæ‹ŸåŒ–æŠ€æœ¯}

\begin{definition}[ç¡¬ä»¶æ”¯æŒçš„è™šæ‹ŸåŒ–æŠ€æœ¯]
    åœ¨X86å¤„ç†ç³»ç»Ÿæ¶æ„ä¸­åŠ å…¥æ–°çš„æŒ‡ä»¤æœºä»¥åŠè¿è¡Œæ¨¡å¼å®Œæˆè™šæ‹ŸåŒ–æ“ä½œ,è¿›è€Œå¯¹ç¡¬ä»¶èµ„æºè¿›è¡Œç›´æ¥è°ƒç”¨,è¿›è¡Œè™šæ‹ŸåŒ–ã€‚ å¦‚AMD-Vç­‰ã€‚ 
\end{definition}

\subsection{ä»è™šæ‹ŸåŒ–çš„å®ç°ç»“æ„åˆ’åˆ†}

\subsubsection{åŸºäºæ“ä½œç³»ç»Ÿçš„è™šæ‹ŸåŒ–}
\begin{definition}[åŸºäºæ“ä½œç³»ç»Ÿçš„è™šæ‹ŸåŒ–]
    åœ¨ä¸€ä¸ªå·²å­˜åœ¨çš„æ“ä½œç³»ç»Ÿä¸Šå®‰è£…è™šæ‹ŸåŒ–è½¯ä»¶

    ç‰¹ç‚¹ï¼š
    
    \begin{itemize}
        \item ç®€å•ã€æ˜“äºå®ç°
        \item å®‰è£…å’Œè¿è¡Œè™šæ‹ŸåŒ–ç¨‹åºä¾èµ–äºä¸»æœºæ“ä½œç³»ç»Ÿå¯¹è®¾å¤‡çš„æ”¯æŒ
        \item æœ‰ä¸¤å±‚OSï¼Œç®¡ç†å¼€é”€è¾ƒå¤§ï¼Œæ€§èƒ½æŸè€—å¤§
        \item è™šæ‹Ÿæœºå¯¹å„ç§ç‰©ç†è®¾å¤‡çš„è°ƒç”¨ï¼Œéƒ½é€šè¿‡è™šæ‹ŸåŒ–å±‚å’Œå®¿ä¸»æœºçš„OSä¸€èµ·åè°ƒæ‰èƒ½å®Œæˆ
    \end{itemize}

    ä¾‹å­ï¼šVmware Workstationå’ŒVirtualBoxç­‰
\end{definition}

2å±‚OSï¼Œæ˜“äºå®ç°ï¼Œå¼€é”€è¾ƒå¤§ï¼Œéœ€è¦ç®¡ç†å±‚OSå±‚è½¬æ¢è¯·æ±‚ 

å¦‚VMware

\subsubsection{åŸºäºç¡¬ä»¶çš„è™šæ‹ŸåŒ–}

\begin{definition}[åŸºäºç¡¬ä»¶çš„è™šæ‹ŸåŒ–]
    å°†è™šæ‹ŸåŒ–è½¯ä»¶ç›´æ¥å®‰è£…åœ¨ç‰©ç†ä¸»æœºç¡¬ä»¶ä¸Šã€‚ 

    ç‰¹ç‚¹ï¼š
    \begin{itemize}
        \item ä¸ä¾èµ–äºä¸»æœºæ“ä½œç³»ç»Ÿ
        \item æ”¯æŒå¤šç§æ“ä½œç³»ç»Ÿï¼Œå¤šç§åº”ç”¨
        \item ä¾èµ–è™šæ‹ŸåŒ–å±‚è¿›è¡Œç®¡ç†
        \item éœ€è¦å¯¹è™šæ‹Ÿå±‚å†…æ ¸è¿›è¡Œå¼€å‘
    \end{itemize}

ä¾‹å­ï¼šVMvare ESXã€Xenç­‰
\end{definition}

çœç•¥OSå±‚ å¦‚xenï¼Œä¾èµ–è™šæ‹ŸåŒ–å±‚è¿›è¡Œç®¡ç†ï¼Œä¸ä¾èµ–äºä¸»æœºOSï¼Œå¯ç›´æ¥è°ƒç”¨ç¡¬ä»¶ ç¼ºç‚¹ï¼šä¾èµ–äºè™šæ‹ŸåŒ–å±‚ï¼Œéœ€è¦å¯¹è™šæ‹ŸåŒ–å±‚è¿›è¡Œå¼€å‘ï¼Œ 

å¦‚ VMware ESXi, XEN

\begin{definition}[VMware ESXi]
    The Purpose-Built Bare Metal Hypervisor
Discover a robust, bare-metal hypervisor that installs directly onto your physical server. With direct access to and control of underlying resources, VMware ESXi effectively partitions hardware to consolidate applications and cut costs. It's the industry leader for efficient architecture, setting the standard for reliability, performance, and support.
\end{definition}

\begin{definition}[Xen]
    the xen project is focused on advancing virtualization in a number of different commercial and open source applications, including server virtualization, infrastructure as a services (iaas), desktop virtualization, security applications, embedded and hardware appliances, and automotive/aviation
\end{definition}

\begin{definition}[Hardware Virtual Machine]
    HVM (known as Hardware Virtual Machine) is the type of instance that mimics bare-metal server setup which provides better hardware isolation. 
    
    With this instance type, the OS can run directly on top of the Virtual Machine without additional configuration making it to look like it is running on a real physical server. For more information about this instance type and the other one that is most commonly used, you may refer to the resource link below.
\end{definition}

\begin{remark}
    Windowsä¸æ”¯æŒHVM.
\end{remark}

ç ”ç©¶æ–¹å‘ï¼šäº‘è®¡ç®—è™šæ‹ŸåŒ–ï¼Œå¦‚live migrationï¼ˆå®æ—¶è™šæ‹Ÿæœºè¿ç§»ï¼šæ— æ„Ÿè¿ç§»ï¼Ÿï¼‰


\subsection{ä»è™šæ‹ŸåŒ–åœ¨äº‘è®¡ç®—çš„åº”ç”¨é¢†åŸŸè¿›è¡Œåˆ’åˆ†}
\begin{definition}[æœåŠ¡å™¨è™šæ‹ŸåŒ–]
    å°†ä¸€å°æœåŠ¡å™¨è™šæ‹Ÿæˆå¤šå°æœåŠ¡å™¨è¿›è¡Œä½¿ç”¨

    å¯¹èµ„æºæ± çš„å·¨å¤§æ–‡ä»¶ç³»ç»Ÿç®¡ç† 
ã€€ã€€å­˜å‚¨èµ„æºç»Ÿä¸€æ•´åˆç®¡ç†ï¼šç›®å½•æ ‘ğŸŒ²ç®¡ç†
ã€€ã€€ğŸ”€åº•å±‚å®ç°é«˜æ•ˆç»„ç»‡ï¼Œä¿æŒéš”ç¦»ï¼Œ
å¤šâ€â€â€è¯»å†™åŒä¸€å°æœºå™¨æ€§èƒ½ç“¶é¢ˆï¼ˆç”¨æˆ·è¡Œä¸ºç‰¹å¾ï¼šç»å¸¸è¯»çš„ç”¨æˆ·ï¼Œç»å¸¸å†™çš„ç”¨æˆ·ï¼Œè°ƒåº¦ï¼‰
\end{definition}

\begin{definition}[å­˜å‚¨è™šæ‹ŸåŒ–]
    å°†æ•´ä¸ªäº‘ç³»ç»Ÿçš„å­˜å‚¨èµ„æºè¿›è¡Œç»Ÿä¸€æ•´åˆç®¡ç†
\end{definition}

\begin{definition}[åº”ç”¨ç¨‹åºè™šæ‹ŸåŒ–]
    æŠŠåº”ç”¨ç¨‹åºå¯¹åº•å±‚ç¡¬ä»¶å’Œç³»ç»Ÿçš„ä¾èµ–æŠ½å–å‡ºæ¥ï¼Œä»è€Œè§£è€¦
\end{definition}

\begin{definition}[å¹³å°è™šæ‹ŸåŒ–]
    é›†æˆå„ç§å¼€å‘èµ„æºè™šæ‹Ÿå‡ºä¸€ä¸ªé¢å‘å¼€å‘äººå‘˜çš„ç»Ÿä¸€æ¥å£ï¼Œå¦‚ç›‘æ§è§†é¢‘å¹³å°ã€æ¶ˆæ¯å¹³å°ã€çŸ­ä¿¡å¹³å°
\end{definition}

\begin{definition}[æ¡Œé¢è™šæ‹ŸåŒ–]
    å°†ç”¨æˆ·çš„æ¡Œé¢ä»¥ä½¿ç”¨çš„ç»ˆç«¯è¿›è¡Œåˆ†ç¦»ï¼Œè¿›è¡Œè§£è€¦

    æ¡Œé¢å’Œterminalè§£è€¦
\end{definition}

\section{è™šæ‹ŸåŒ–æŠ€æœ¯}


\subsection{å®Œå…¨è™šæ‹ŸåŒ–æŠ€æœ¯}

\begin{definition}[å®Œå…¨è™šæ‹ŸåŒ–æŠ€æœ¯]
    é€šè¿‡hypervisoråœ¨è™šæ‹ŸæœåŠ¡å™¨å’Œåº•å±‚ç¡¬ä»¶ä¹‹é—´å»ºç«‹ä¸€ä¸ªæŠ½è±¡å±‚ã€‚ 
\end{definition}

æœ€æµè¡Œçš„è™šæ‹ŸåŒ–æ–¹æ³•ä½¿ç”¨hypervisor,åœ¨è™šæ‹ŸæœåŠ¡å™¨å’Œåº•å±‚ç¡¬ä»¶ä¹‹é—´å»ºç«‹ä¸€ä¸ªæŠ½è±¡å±‚ã€‚ VMwareå’Œå¾®è½¯çš„VirtualPCæ˜¯ä»£è¡¨è¯¥æ–¹æ³•çš„ä¸¤ä¸ªå•†ç”¨äº§å“,è€ŒåŸºäºæ ¸å¿ƒçš„è™šæ‹Ÿæœº(KVM)æ˜¯é¢å‘Linuxç³»ç»Ÿçš„å¼€æºäº§å“ã€‚ 

hypervisorå¯ä»¥æ•è·CPUæŒ‡ä»¤,ä¸ºæŒ‡ä»¤è®¿é—®ç¡¬ä»¶æ§åˆ¶å™¨å’Œå¤–è®¾å……å½“ä¸­ä»‹ã€‚ å› è€Œ,å®Œå…¨è™šæ‹ŸåŒ–æŠ€æœ¯å‡ ä¹èƒ½è®©ä»»ä½•ä¸€æ¬¾æ“ä½œç³»ç»Ÿä¸ç”¨æ”¹åŠ¨å°±èƒ½å®‰è£…åˆ°è™šæ‹ŸæœåŠ¡å™¨ä¸Š,è€Œå®ƒä»¬ä¸çŸ¥é“è‡ªå·±è¿è¡Œåœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸‹ã€‚ ä¸»è¦ç¼ºç‚¹æ˜¯, hypervisorç»™å¤„ç†å™¨å¸¦æ¥å¼€é”€ã€‚ 


\subsection{å‡†è™šæ‹ŸåŒ–æŠ€æœ¯}

\begin{definition}[å‡†è™šæ‹ŸåŒ–æŠ€æœ¯]
    å®Œå…¨è™šæ‹ŸåŒ–æ˜¯å¤„ç†å™¨å¯†é›†å‹æŠ€æœ¯,å› ä¸ºå®ƒè¦æ±‚hypervisorç®¡ç†å„ä¸ªè™šæ‹ŸæœåŠ¡å™¨,å¹¶è®©å®ƒä»¬å½¼æ­¤ç‹¬ç«‹ã€‚ å‡è½»è¿™ç§è´Ÿæ‹…çš„ä¸€ç§æ–¹æ³•å°±æ˜¯,æ”¹åŠ¨å®¢æˆ·æ“ä½œç³»ç»Ÿ,è®©å®ƒä»¥ä¸ºè‡ªå·±è¿è¡Œåœ¨è™šæ‹Ÿç¯å¢ƒä¸‹,èƒ½å¤Ÿä¸hypervisorååŒå·¥ä½œã€‚ è¿™ç§æ–¹æ³•å°±å«\textit{å‡†è™šæ‹ŸåŒ–(para-virtualization)}. 
\end{definition}

Xenæ˜¯å¼€æºå‡†è™šæ‹ŸåŒ–æŠ€æœ¯çš„ä¸€ä¸ªä¾‹å­ã€‚ æ“ä½œç³»ç»Ÿä½œä¸ºè™šæ‹ŸæœåŠ¡å™¨åœ¨Xen hypervisorä¸Šè¿è¡Œä¹‹å‰,å®ƒå¿…é¡»åœ¨æ ¸å¿ƒå±‚é¢è¿›è¡ŒæŸäº›æ”¹å˜ã€‚ å› æ­¤, Xené€‚ç”¨äºBSDLinux, SolarisåŠå…¶ä»–å¼€æºæ“ä½œç³»ç»Ÿ,ä½†ä¸é€‚åˆå¯¹åƒWindowsè¿™äº›ä¸“æœ‰çš„æ“ä½œç³»ç»Ÿè¿›è¡Œè™šæ‹ŸåŒ–å¤„ç†,å› ä¸ºå®ƒä»¬æ— æ³•æ”¹åŠ¨ã€‚ 

å‡†è™šæ‹ŸåŒ–æŠ€æœ¯çš„ä¼˜ç‚¹æ˜¯æ€§èƒ½é«˜ã€‚ 


\subsection{CPUè™šæ‹ŸåŒ–æŠ€æœ¯}


\begin{definition}[CPUè™šæ‹ŸåŒ–æŠ€æœ¯]
    ä¸€ä¸ªcore$\rightarrow$ ä¸€ä¸ªè™šæ‹Ÿæœºã€‚
\end{definition}

CPUçš„è™šæ‹ŸåŒ–æŠ€æœ¯å¯ä»¥å•CPUæ¨¡æ‹Ÿå¤šCPUå¹¶è¡Œï¼Œå…è®¸ä¸€ä¸ªå¹³å°åŒæ—¶è¿è¡Œå¤šä¸ªæ“ä½œç³»ç»Ÿï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºéƒ½å¯ä»¥åœ¨ç›¸äº’ç‹¬ç«‹çš„ç©ºé—´å†…è¿è¡Œè€Œäº’ä¸å½±å“ï¼Œä»è€Œæ˜¾è‘—æé«˜è®¡ç®—æœºçš„å·¥ä½œæ•ˆç‡ã€‚ 

\begin{definition}[virtual CPUs]
    ä¸ç¡¬ä»¶æ— å…³
\end{definition}

\begin{definition}[core, locigal CPU]
    é€»è¾‘å¤„ç†å™¨
\end{definition}

\begin{definition}[hyperthread]
    ä¸€ä¸ªæ ¸å˜2ä¸ªæ ¸ï¼ˆæŸäº›ç¡¬ä»¶å­˜åœ¨2ä»½ï¼Œå¦‚registersï¼ŒåŠ å¿«è¿ç®—å•å…ƒè¿ç®—ï¼Œä¸€ä¸ªçº¿ç¨‹blockæ—¶æ‰§è¡Œå¦ä¸€çº¿ç¨‹ï¼‰
\end{definition}

\begin{remark}
    è™šæ‹ŸCPUæ€§èƒ½å–å†³äº2çº§è°ƒåº¦çš„æ•ˆç‡ã€‚

    guest application$\rightarrow$ è™šæ‹ŸCPUè°ƒåº¦
    è™šæ‹ŸCPUå‘å‡ºæŒ‡ä»¤$\rightarrow$ vmmè°ƒåº¦$\rightarrow$ ç‰©ç†æ ¸(ä»»åŠ¡é˜Ÿåˆ—)

    \begin{figure}[htbp]
        \begin{center}
            \includegraphics[width=\textwidth]{cloud-cpu-virtualization.png}
        \end{center}
    \end{figure}
\end{remark}



\subsection{CPUå…¨è™šæ‹ŸåŒ–}
ä¸»è¦é‡‡ç”¨ä¼˜å…ˆçº§å‹ç¼©æŠ€æœ¯(\term{Ring Compression})å’ŒäºŒè¿›åˆ¶ä»£ç ç¿»è¯‘æŠ€æœ¯Binary Translation) . ä¼˜å…ˆçº§å‹ç¼©æŠ€æœ¯è®©VMMå’ŒGuestè¿è¡Œåœ¨ä¸åŒçš„ç‰¹æƒçº§ä¸‹ã€‚ 

å¯¹X86æ¶æ„è€Œè¨€ï¼Œå³VMMè¿è¡Œåœ¨æœ€é«˜ç‰¹æƒçº§åˆ«Ring 0ä¸‹ï¼Œ Guest OSè¿è¡Œåœ¨Ring 1ä¸‹ï¼Œç”¨æˆ·åº”ç”¨è¿è¡Œåœ¨Ring 3ä¸‹ã€‚ å› æ­¤Guest OSçš„æ ¸å¿ƒæŒ‡ä»¤\textbf{æ— æ³•ç›´æ¥ä¸‹è¾¾åˆ°è®¡ç®—æœºç³»ç»Ÿç¡¬ä»¶æ‰§è¡Œ}ï¼Œè€Œæ˜¯éœ€è¦ç»è¿‡VMMçš„\textbf{æ•è·}å’Œ\textbf{æ¨¡æ‹Ÿ}æ‰§è¡Œ(éƒ¨åˆ†éš¾ä»¥è™šæ‹ŸåŒ–çš„æŒ‡ä»¤éœ€è¦é€šè¿‡\term{Binary Translation}æŠ€æœ¯è¿›è¡Œè½¬æ¢) . 

\begin{figure}[htbp]
    \begin{center}
        \includegraphics[]{cloud-cpu-full-virtualization.png}
    \end{center}
\end{figure}

\subsection{CPUåŠè™šæ‹ŸåŒ–}
    
ä¸»è¦é‡‡ç”¨\term{Hypercall}æŠ€æœ¯ã€‚ 

\textbf{Guest OSçš„éƒ¨åˆ†ä»£ç è¢«æ”¹å˜}ï¼Œä»è€Œä½¿Guest OSä¼šå°†å’Œç‰¹æƒæŒ‡ä»¤ç›¸å…³çš„æ“ä½œéƒ½è½¬æ¢ä¸ºå‘ç»™VMMçš„Hypercall (è¶…çº§è°ƒç”¨) ï¼Œç”±VMMç»§ç»­è¿›è¡Œå¤„ç†ã€‚ è€ŒHypercallæ”¯æŒçš„æ‰¹å¤„ç†å’Œå¼‚æ­¥è¿™ä¸¤ç§ä¼˜åŒ–æ–¹å¼ï¼Œä½¿å¾—é€šè¿‡Hypercallèƒ½å¾—åˆ°è¿‘ä¼¼äºç‰©ç†æœºçš„é€Ÿåº¦ã€‚ 

\begin{figure}[htbp]
    \begin{center}
        \includegraphics[width=\textwidth]{cloud-cpu-para-virtualization.png}
    \end{center}
\end{figure}

\subsection{CPUç¡¬ä»¶è¾…åŠ©è™šæ‹ŸåŒ–æŠ€æœ¯}

ç›®å‰ä¸»è¦æœ‰Intelçš„\term{VT-x}å’ŒAMDçš„\term{AMD-V}è¿™ä¸¤ç§æŠ€æœ¯ã€‚ 

å…¶æ ¸å¿ƒæ€æƒ³éƒ½æ˜¯é€šè¿‡å¼•å…¥æ–°çš„æŒ‡ä»¤å’Œè¿è¡Œæ¨¡å¼,ä½¿VMMå’ŒGuest OSåˆ†åˆ«è¿è¡Œåœ¨ä¸åŒæ¨¡å¼(\term{Rootæ¨¡å¼}å’ŒéROOTæ¨¡å¼)ä¸‹,ä¸”Guest OSè¿è¡Œåœ¨Ring 0ä¸‹ã€‚ é€šå¸¸æƒ…å†µä¸‹, Guest OSçš„æ ¸å¿ƒæŒ‡ä»¤å¯ä»¥ç›´æ¥ä¸‹è¾¾åˆ°è®¡ç®—æœºç³»ç»Ÿç¡¬ä»¶æ‰§è¡Œ,è€Œä¸éœ€è¦ç»è¿‡VMM,å½“Guest OSæ‰§è¡Œåˆ°ç‰¹æ®ŠæŒ‡ä»¤çš„æ—¶å€™,ç³»ç»Ÿä¼šåˆ‡æ¢åˆ°VMM,è®©VMMæ¥å¤„ç†ç‰¹æ®ŠæŒ‡ä»¤ã€‚ 

åŒºåˆ†rootæ¨¡å¼, monitorè¿è¡Œåœ¨rootæ¨¡å¼è¿è¡Œï¼Œè™šæ‹Ÿæœºæ”¯æŒérootçš„ring0ï¼Œç¡¬ä»¶åŒºåˆ†æ¥è‡ªguest OSæŒ‡ä»¤å’Œhost OSæŒ‡ä»¤ï¼Œæ ¸å¿ƒæŒ‡ä»¤å¯ä»¥ç›´æ¥å‘é€ç»™CPUè€Œæ— éœ€vmmæ•æ‰

\begin{figure}[htbp]
    \begin{center}
        \includegraphics[]{cloud-cpu-assisted-virtualization.png}
    \end{center}
\end{figure}

\subsection{å†…å­˜è™šæ‹ŸåŒ–æŠ€æœ¯}

å†…å­˜è™šæ‹ŸåŒ–æŠ€æœ¯çš„äº§ç”Ÿï¼šå†…å­˜è™šæ‹ŸåŒ–çš„äº§ç”ŸæºäºVMMä¸å®¢æˆ·ç³»ç»Ÿåœ¨å¯¹ç‰©ç†å†…å­˜çš„è®¤è¯†ä¸Šå­˜åœ¨å†²çª,é€ æˆç‰©ç†å†…å­˜çœŸæ­£æ‹¥æœ‰è€…-VMMå¿…é¡»å¯¹ç³»ç»Ÿè®¿é—®çš„å†…å­˜è¿›è¡Œä¸€å®šç¨‹åº¦ä¸Šçš„è™šæ‹ŸåŒ–ã€‚ 

è™šæ‹Ÿæœºçš„å†…å­˜æ˜ å°„åˆ°çœŸå®å­˜å‚¨å™¨çš„é¡ºåº: çœŸå®ç‰©ç†å†…å­˜$\rightarrow$ å…¶ä»–å­˜å‚¨ï¼Œï¸è¶…è¿‡ç‰©ç†å†…å­˜æ—¶performanceä¸‹é™

$è™šæ‹Ÿåœ°å€\leftrightarrow^{translation}å®é™…åœ°å€$

æ¯ä¸ªè¿›ç¨‹çœ‹åˆ°ç‹¬ç«‹çš„åœ°å€å†…å­˜ç©ºé—´
å‡å¦‚è¶…è¿‡å†…å­˜ç©ºé—´ï¼Œéœ€ç­‰å¾…å…¶ä»–ç¨‹åºé‡Šæ”¾

è™šæ‹Ÿåœ°å€ $\leftrightarrow$ real memory addressï¼ˆè™šæ‹Ÿæœºæ‰€çœ‹åˆ°çš„è™šæ‹Ÿåœ°å€ï¼‰ $\leftrightarrow$ physicalï¼ˆç‰©ç†æœºçœ‹åˆ°çš„è™šæ‹Ÿåœ°å€ï¼‰

\subsubsection{å†…å­˜å…¨è™šæ‹ŸåŒ–æŠ€æœ¯}

é€šè¿‡ä½¿ç”¨å½±å­é¡µè¡¨(Shadow Page Table)å®ç°è™šæ‹ŸåŒ–ã€‚ 

VMMä¸ºæ¯ä¸ªGuestéƒ½ç»´æŠ¤ä¸€ä¸ªå½±å­é¡µè¡¨,å½±å­é¡µè¡¨ç»´æŠ¤è™šæ‹Ÿåœ°å€(VA)åˆ°æœºå™¨åœ°å€(MA)çš„æ˜ å°„å…³ç³»ã€‚ è€ŒGuesté¡µè¡¨ç»´æŠ¤VAåˆ°å®¢æˆ·æœºç‰©ç†åœ°å€(GPA)çš„æ˜ å°„å…³ç³»ã€‚ 

å½“VMMæ•è·åˆ°Guesté¡µè¡¨çš„ä¿®æ”¹å, VMMä¼šæŸ¥æ‰¾è´Ÿè´£GPAåˆ°MAæ˜ å°„çš„P2Mé¡µè¡¨æˆ–è€…å“ˆå¸Œå‡½æ•°,æ‰¾åˆ°ä¸è¯¥GPAå¯¹åº”çš„MA,å†å°†MAå¡«å……åˆ°çœŸæ­£åœ¨ç¡¬ä»¶ä¸Šèµ·ä½œç”¨çš„å½±å­é¡µè¡¨,ä»è€Œå½¢æˆVAåˆ°MAçš„æ˜ å°„å…³ç³»ã€‚ è€ŒGuestçš„é¡µè¡¨åˆ™æ— éœ€å˜åŠ¨ã€‚ 

page tableï¼šè™šæ‹Ÿåœ°å€$\rightarrow$ ç‰©ç†åœ°å€ï¼›æœ‰ç›¸å…³æŠ€æœ¯åŠ é€Ÿæ£€ç´¢

shadow é¡µè¡¨ï¼ˆå®¢æˆ·æœºé¡µè¡¨ï¼‰ï¼šç»´æŠ¤è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€$\rightarrow$ guest osåœ°å€ï¼ˆguest physical addressï¼Œå¦‚è™šæ‹Ÿæœºç”³è¯·çš„ï¼‰

p2mé¡µè¡¨/å“ˆå¸Œå‡½æ•° GPAåœ°å€$\rightarrow$ æœºå™¨åœ°å€â€¦â€¦å¡«å……åˆ°åœ¨ç¡¬ä»¶ä¸Šèµ·ä½œç”¨çš„æ˜¯å½±å­é¡µè¡¨


\begin{figure}[htbp]
    \begin{center}
        \includegraphics[]{cloud-memory-full-virtualization.png}
    \end{center}
\end{figure}


\subsubsection{å†…å­˜åŠè™šæ‹ŸåŒ–æŠ€æœ¯}

é€šè¿‡ä½¿ç”¨é¡µè¡¨å†™å…¥æ³•å®ç°è™šæ‹ŸåŒ–ã€‚

Guest OSåœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„é¡µè¡¨æ—¶,ä¼šå‘VMMæ³¨å†Œè¯¥é¡µè¡¨ã€‚ ä¹‹ååœ¨Guestè¿è¡Œçš„æ—¶å€™, VMMå°†ä¸æ–­çš„ç®¡ç†å’Œç»´æŠ¤è¿™ä¸ªè¡¨,ä½¿Guestä¸Šé¢çš„ç¨‹åºèƒ½ç›´æ¥è®¿é—®åˆ°åˆé€‚çš„åœ°å€ã€‚ 

guest osç›´æ¥å‘vmmæ³¨å†Œ, vmmè·¨å±‚ç»´æŠ¤é¡µè¡¨, virtual addressç›´æ¥ç¿»è¯‘æˆphysical address

\subsubsection{å†…å­˜ç¡¬ä»¶è¾…åŠ©è™šæ‹ŸåŒ–æŠ€æœ¯}

é€šè¿‡æ‰©å±•é¡µè¡¨EPT (\term{extended page table})å®ç°è™šæ‹ŸåŒ–ã€‚ 

EPTé€šè¿‡ä½¿ç”¨ç¡¬ä»¶è™šæ‹ŸåŒ–æŠ€æœ¯,ä½¿å…¶èƒ½åœ¨åŸæœ‰çš„é¡µè¡¨çš„åŸºç¡€ä¸Š,å¢åŠ ä¸€ä¸ªEPTé¡µè¡¨,ç”¨äºè®°å½•GPAåˆ°MAçš„æ˜ å°„å…³ç³»ã€‚ VMMé¢„å…ˆæŠŠEPTé¡µè¡¨è®¾ç½®åˆ°CPUä¸­ã€‚ 

Guestä¿®æ”¹Guesté¡µè¡¨,æ— éœ€VMMå¹²é¢„ã€‚ åœ°å€è½¬æ¢æ—¶, CPUè‡ªåŠ¨æŸ¥æ‰¾ä¸¤å¼ é¡µè¡¨å®ŒæˆGuestè™šæ‹Ÿåœ°å€åˆ°æœºå™¨åœ°å€çš„è½¬æ¢,ä»è€Œé™ä½æ•´ä¸ªå†…å­˜è™šæ‹ŸåŒ–æ‰€éœ€çš„å¼€é”€ã€‚ 

\begin{figure}[htbp]
    \begin{center}
        \includegraphics[]{cloud-memory-assisted-virtualization.png}
    \end{center}
\end{figure}

\subsection{I/Oè™šæ‹ŸåŒ–æŠ€æœ¯}


\section{å¸¸è§çš„è™šæ‹ŸåŒ–äº§å“}

\begin{itemize}
    \item Hyper-Vè™šæ‹ŸåŒ–
    \item Xenè™šæ‹ŸåŒ–
    \item Vmwareè™šæ‹ŸåŒ–
    \item VirtualBoxè™šæ‹ŸåŒ–
    \item KVMè™šæ‹ŸåŒ–
    \item Dockerè™šæ‹ŸåŒ–
\end{itemize}


\section{å®¹å™¨}

\begin{definition}[å®¹å™¨]
    åˆ©ç”¨ä¸€ä¸ªå¼€æºçš„å®¹å™¨å¼•æ“ï¼Œè®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„é•œåƒä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä¸€Linuxæˆ–Windowsæœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚ 
\end{definition}

\begin{definition}[é•œåƒ]
    å¯æ‰§è¡Œçš„ç‹¬ç«‹è½¯ä»¶åŒ…ï¼ŒåŒ…å«è½¯ä»¶è¿è¡Œçš„å†…å®¹ï¼šä»£ç ï¼Œè¿è¡Œæ—¶ç¯å¢ƒï¼Œç³»ç»Ÿå·¥å…·ï¼Œç³»ç»Ÿåº“å’Œè®¾ç½®ã€‚ 
\end{definition}

\begin{definition}[Docker]
    åŸºäºå®¹å™¨æŠ€æœ¯çš„\textbf{è½»é‡çº§}è™šæ‹ŸåŒ–è§£å†³æ–¹æ¡ˆã€‚ Dockeræ˜¯å®¹å™¨å¼•æ“ï¼ŒæŠŠLinuxçš„cgroupã€namespaceç­‰å®¹å™¨åº•å±‚æŠ€æœ¯è¿›è¡Œå°è£…æŠ½è±¡ï¼Œä¸ºç”¨æˆ·æä¾›äº†åˆ›å»ºå’Œç®¡ç†å®¹å™¨çš„ä¾¿æ·ç•Œé¢ï¼ˆåŒ…æ‹¬å‘½ä»¤è¡Œå’ŒAPIï¼‰

\end{definition}

Dockerä½œç”¨ï¼šå°†åº”ç”¨ç¨‹åºä¸è¯¥ç¨‹åºçš„ä¾èµ–ï¼Œæ‰“åŒ…åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œè¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿå®¹å™¨ã€‚ ç¨‹åºåœ¨è¿™ä¸ªè™šæ‹Ÿå®¹å™¨é‡Œè¿è¡Œï¼Œå°±å¥½åƒåœ¨çœŸå®çš„ç‰©ç†æœºä¸Šè¿è¡Œä¸€æ ·ã€‚ æœ‰äº†Dockerï¼Œå°±ä¸ç”¨æ‹…å¿ƒç¯å¢ƒé—®é¢˜[å°†ç¨‹åºå’ŒdependencyåŒ…å«åœ¨ä¸€ä¸ªimageä¸­ï¼Œä½¿å¾—å¯¹äºå…¨å±€é…ç½®çš„ä¾èµ–è§£è€¦ï¼ˆåº”ç”¨å’Œè¿è¡Œç¯å¢ƒæ‰“åŒ…ï¼‰]. 

\textbf{è½»é‡çº§}çš„å®¹å™¨ï¼Œå¯ä»¥åªå«æœ‰ä¸€ä¸ªAPPåŠå…¶ä¾èµ–ã€‚ base imageåŒ…å«OSç­‰ï¼ŒAPP imageåœ¨base imageä¹‹ä¸Š

æ ¸å¿ƒï¼šå®ç°åº”ç”¨ä¸è¿è¡Œç¯å¢ƒæ•´ä½“æ‰“åŒ…ä»¥åŠæ‰“åŒ…æ ¼å¼ç»Ÿä¸€ã€‚ 

Dockerçš„å¥½å¤„

\begin{itemize}
    \item ç§’çº§çš„äº¤ä»˜å’Œéƒ¨ç½² $\rightarrow$ serverlessä¾èµ–äºè½»é‡çº§å®¹å™¨æŠ€æœ¯ï¼Œæ‰§è¡Œæ¯«ç§’çº§é«˜æ€§èƒ½è¦æ±‚ä»»åŠ¡ï¼Œé‡é‡çº§å®¹å™¨å¯åŠ¨æ…¢ï¼Œè½»é‡çº§åªåŒ…å«minimal setï¼Œdeployå¿«;ä¸å®šæ—¶çš„æœåŠ¡éœ€æ±‚ï¼Œéœ€è¦å°½å¿«è¿”å›ç»“æœ$\rightarrow$ å°½å¿«éƒ¨ç½², å¦‚æœç´¢æœåŠ¡
    \item ä¿è¯ç¯å¢ƒä¸€è‡´æ€§
    \item é«˜æ•ˆçš„èµ„æºåˆ©ç”¨
    \item å¼¹æ€§çš„ä¼¸ç¼©
    \item åŠ¨æ€è°ƒåº¦è¿ç§»æˆæœ¬ä½
\end{itemize}

ä¸€ä¸ªå®Œæ•´çš„Dockeræœ‰ä»¥ä¸‹å‡ éƒ¨åˆ†ç»„æˆï¼š
å®¢æˆ·ç«¯ï¼ˆ\term{Docker Client}ï¼‰ã€å®ˆæŠ¤è¿›ç¨‹ï¼ˆ\term{Docker Daemon}ï¼‰ã€é•œåƒï¼ˆ\term{Docker Image}ï¼‰ã€å®¹å™¨ï¼ˆ\term{Docker Container}ï¼‰ã€ä»“åº“ï¼ˆ\term{Docker Registry}ï¼‰

\begin{figure}[htbp]
    \centering
    \includegraphics[width=\textwidth]{cloud-docker-architecture.png}
\end{figure}

Dockeré‡‡ç”¨C/Sæ¶æ„ï¼ŒDocker Daemonä½œä¸ºæœåŠ¡ç«¯æ¥å—æ¥è‡ªå®¢æˆ·çš„è¯·æ±‚ï¼Œå¹¶å¤„ç†è¿™äº›è¯·æ±‚ï¼ˆåˆ›å»ºã€è¿è¡Œã€åˆ†å‘å®¹å™¨ï¼‰ã€‚ å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ—¢å¯ä»¥è¿è¡Œåœ¨ä¸€ä¸ªæœºå™¨ä¸Šï¼Œä¹Ÿå¯é€šè¿‡socketæˆ–è€…RESTful APIæ¥è¿›è¡Œé€šä¿¡ã€‚ 

Docker daemonä¸€èˆ¬åœ¨å®¿ä¸»ä¸»æœºåå°è¿è¡Œï¼Œç­‰å¾…æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯ã€‚ Dockerå®¢æˆ·ç«¯åˆ™ä¸ºç”¨æˆ·æä¾›ä¸€ç³»åˆ—å¯æ‰§è¡Œå‘½ä»¤ï¼Œç”¨æˆ·ç”¨è¿™äº›å‘½ä»¤å®ç°è·ŸDocker daemonäº¤äº’ã€‚ 

\begin{figure}[htbp]
    \centering
    \includegraphics[width=\textwidth]{cloud-docker-architecture-2.png}
\end{figure}

\begin{definition}[Cluster]

\end{definition}

é›†ç¾¤ï¼šåŸºç¡€è¿è¡Œæ”¶è´¹ï¼ˆï¼šåªæœ‰è¿è¡Œæ—¶æ‰èƒ½autoscaleï¼‰+ç”¨æˆ·requestå¤šæ”¶è´¹$\rightarrow$ é€‚ç”¨äºä¸­å°ä¼ä¸š

\begin{example}
    10 tasksï¼šæŸ¥è¯¢çš„æ•°æ®åº“ã€ä»£ç ç­‰éœ€å…ˆå­˜å…¥ï¸é›†ç¾¤ä¸­, 
å½“æœ‰æ–°è¯·æ±‚æ—¶ï¼Œï¸è‡ªåŠ¨éƒ¨ç½²æ–°å®¹å™¨
\end{example}

é›†ç¾¤ç”±k8sç®¡ç†ï¼Œæ•ˆç‡é«˜; æœ‰å¼¹æ€§; live migrationæˆæœ¬ä½

\section{è™šæ‹Ÿæœºä¸å®¹å™¨çš„å¯¹æ¯”}


\begin{figure}[htbp]
    \includegraphics[width=\textwidth]{cloud-vmware-container-architecture.png}
\end{figure}

\begin{figure}[htbp]
    \includegraphics[width=\textwidth]{cloud-comparison-vmware-docker.png}
\end{figure}

\section{MapReduce, å¹¶è¡Œ}

\term{concurrent å¹¶è¡Œ}ï¼šåŒæ—¶è¿›è¡Œ

\term{ï¼ˆåˆ†æ—¶ï¼‰å¹¶å‘}ï¼š2ä¸ªä»»åŠ¡åŒæ—¶å‘ç”Ÿï¼Œçœ‹ä¼¼åŒæ—¶è¿è¡Œï¼Œä½†æœªå¿…åŒæ—¶è¿›è¡Œ

\subsection{è°ƒåº¦}

ä¸åŒä»»åŠ¡ä¹‹é—´ã€ä¸åŒio/ç½‘ç»œç­‰

MapReduce$\rightarrow$ Hadoop ï¼Œspark $\rightarrow$ sparkçš„è°ƒåº¦